---
# tasks file for chrome-browser
- name: Check that chrome not already installed
  ansible.builtin.stat:
    path: '/usr/bin/google-chrome'
  register: chrome
  tags:
    - chrome
    - packages

- name: Run Chrome installation tasks
  ansible.builtin.include_tasks: tasks.yml
  when: not chrome.stat.exists
  tags:
    - chrome
    - packages

- name: Ensure Chrome recommended policy directory exists
  ansible.builtin.file:
    path: /etc/opt/chrome/policies/recommended
    state: directory
    owner: root
    group: root
    mode: '0755'
  tags:
    - chrome
    - configuration

- name: Configure Chrome recommended policies
  ansible.builtin.copy:
    src: recommended.json
    dest: /etc/opt/chrome/policies/recommended/prefs.json
    owner: root
    group: root
    mode: '0644'
  tags:
    - chrome
    - configuration

- name: Ensure Chrome managed policy directory exists
  ansible.builtin.file:
    path: /etc/opt/chrome/policies/managed
    state: directory
    owner: root
    group: root
    mode: '0755'
  tags:
    - chrome
    - configuration

- name: Configure Chrome managed policies (browser extensions)
  ansible.builtin.copy:
    src: managed.json
    dest: /etc/opt/chrome/policies/managed/prefs.json
    owner: root
    group: root
    mode: '0644'
  tags:
    - chrome
    - configuration
    - extensions
  # Managed extensions configured:
  # - aeblfdkhhhdcdjpifhhbdiojplfjncoa: 1Password Password Manager
  # - nngceckbapebfimnlniiiahkandclblb: Bitwarden Password Manager
