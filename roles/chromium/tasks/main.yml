---
# tasks file for chromium

- name: Ensure Flatpak is installed
  ansible.builtin.apt:
    name: flatpak
    state: present
    update_cache: true
  tags:
    - chromium
    - packages
    - browser
    - flatpak

- name: Check if flatpak executable is available
  ansible.builtin.command: which flatpak
  register: chromium_flatpak_executable_check
  changed_when: false
  failed_when: false
  tags:
    - chromium
    - packages
    - browser
    - flatpak

- name: Add Flathub repository
  community.general.flatpak_remote:
    name: flathub
    state: present
    flatpakrepo_url: https://flathub.org/repo/flathub.flatpakrepo
  when: chromium_flatpak_executable_check.rc == 0
  tags:
    - chromium
    - packages
    - browser
    - flatpak

- name: Install Chromium from Flathub
  community.general.flatpak:
    name: org.chromium.Chromium
    state: present
    remote: flathub
  when: chromium_flatpak_executable_check.rc == 0
  tags:
    - chromium
    - packages
    - browser
    - flatpak

- name: Remove old Chromium PPA repository file if it exists
  ansible.builtin.file:
    path: /etc/apt/sources.list.d/savoury1-chromium.list
    state: absent
  tags:
    - chromium
    - cleanup

- name: Remove old Chromium PPA keyring if it exists
  ansible.builtin.file:
    path: /usr/share/keyrings/savoury1-chromium-ppa.gpg
    state: absent
  tags:
    - chromium
    - cleanup

- name: Remove old Chromium APT preferences file if it exists
  ansible.builtin.file:
    path: "{{ chromium_apt_preferences_file }}"
    state: absent
  tags:
    - chromium
    - cleanup
