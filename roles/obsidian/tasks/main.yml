---
# tasks file for obsidian

- name: Ensure Flatpak is available
  ansible.builtin.package_facts:
    manager: auto
  tags:
    - obsidian
    - packages
    - productivity
    - notes

- name: Check if Flatpak is installed
  ansible.builtin.assert:
    that:
      - "'flatpak' in ansible_facts.packages"
    fail_msg: "Flatpak must be installed before installing Obsidian. Ensure the 'flatpak' role runs before this role."
    success_msg: "Flatpak is installed and ready."
  tags:
    - obsidian
    - packages
    - productivity
    - notes

- name: Check if flatpak executable is available
  ansible.builtin.command: which flatpak
  register: obsidian_flatpak_executable_check
  changed_when: false
  failed_when: false
  tags:
    - obsidian
    - packages
    - productivity
    - notes

- name: Install Obsidian via Flatpak
  community.general.flatpak:
    name: "{{ obsidian_flatpak_name }}"
    state: present
    remote: "{{ obsidian_flatpak_remote }}"
  when: obsidian_flatpak_executable_check.rc == 0
  tags:
    - obsidian
    - packages
    - productivity
    - notes
